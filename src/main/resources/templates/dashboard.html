<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" th:replace="~{layout/base :: html}">
<head>
    <th:block th:fragment="page-css">
        <style>
            .dashboard-stats {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 1.5rem;
                margin-bottom: 2rem;
            }
            
            .quick-actions {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 1rem;
                margin-bottom: 2rem;
            }
            
            .quick-action-card {
                background: white;
                border-radius: 8px;
                padding: 1.5rem;
                text-align: center;
                box-shadow: var(--shadow);
                border: 1px solid var(--border-color);
                transition: transform 0.2s, box-shadow 0.2s;
                text-decoration: none;
                color: inherit;
            }
            
            .quick-action-card:hover {
                transform: translateY(-2px);
                box-shadow: var(--shadow-lg);
                text-decoration: none;
                color: inherit;
            }
            
            .quick-action-icon {
                font-size: 2rem;
                color: var(--primary-color);
                margin-bottom: 1rem;
            }
            
            .recent-activity {
                background: white;
                border-radius: 8px;
                box-shadow: var(--shadow);
                border: 1px solid var(--border-color);
            }
            
            .activity-item {
                padding: 1rem;
                border-bottom: 1px solid var(--border-color);
                display: flex;
                align-items: center;
                gap: 1rem;
            }
            
            .activity-item:last-child {
                border-bottom: none;
            }
            
            .activity-icon {
                width: 40px;
                height: 40px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 1.2rem;
                color: white;
            }
            
            .activity-icon.visit { background: var(--info-color); }
            .activity-icon.test { background: var(--success-color); }
            .activity-icon.equipment { background: var(--warning-color); }
            .activity-icon.inventory { background: var(--danger-color); }
            
            .activity-content {
                flex: 1;
            }
            
            .activity-title {
                font-weight: 600;
                margin-bottom: 0.25rem;
            }
            
            .activity-time {
                color: var(--secondary-color);
                font-size: 0.875rem;
            }
        </style>
    </th:block>
</head>
<body>
    <div th:fragment="content">
        <!-- Dashboard Statistics -->
        <div class="dashboard-stats">
            <div class="stats-card" id="equipment-stats">
                <div class="stats-value">-</div>
                <div class="stats-label">Total Equipment</div>
                <div class="status-breakdown mt-4"></div>
            </div>
            
            <div class="stats-card" id="inventory-stats">
                <div class="stats-value">-</div>
                <div class="stats-label">Inventory Items</div>
                <div class="status-breakdown mt-4"></div>
            </div>
            
            <div class="stats-card" id="workflow-stats">
                <div class="stats-value">-</div>
                <div class="stats-label">Active Workflows</div>
                <div class="status-breakdown mt-4"></div>
            </div>
            
            <div class="stats-card" id="network-stats">
                <div class="stats-value">-</div>
                <div class="stats-label">Network Connections</div>
                <div class="status-breakdown mt-4"></div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="card mb-4">
            <div class="card-header">
                <h3 class="card-title">Quick Actions</h3>
            </div>
            <div class="card-body">
                <div class="quick-actions">
                    <a href="/visits-ui/new" class="quick-action-card">
                        <div class="quick-action-icon">
                            <i class="fas fa-user-plus"></i>
                        </div>
                        <h4>New Visit</h4>
                        <p>Register a new patient visit</p>
                    </a>
                    
                    <a href="/samples/new" class="quick-action-card">
                        <div class="quick-action-icon">
                            <i class="fas fa-vial"></i>
                        </div>
                        <h4>Register Sample</h4>
                        <p>Add a new sample to the system</p>
                    </a>
                    
                    <a href="/equipment/new" class="quick-action-card">
                        <div class="quick-action-icon">
                            <i class="fas fa-microscope"></i>
                        </div>
                        <h4>Add Equipment</h4>
                        <p>Register new lab equipment</p>
                    </a>
                    
                    <a href="/inventory/new" class="quick-action-card">
                        <div class="quick-action-icon">
                            <i class="fas fa-box"></i>
                        </div>
                        <h4>Add Inventory</h4>
                        <p>Add new inventory item</p>
                    </a>
                    
                    <a href="/reports" class="quick-action-card">
                        <div class="quick-action-icon">
                            <i class="fas fa-file-medical"></i>
                        </div>
                        <h4>View Reports</h4>
                        <p>Access lab reports</p>
                    </a>
                    
                    <a href="/network" class="quick-action-card">
                        <div class="quick-action-icon">
                            <i class="fas fa-wifi"></i>
                        </div>
                        <h4>Network Status</h4>
                        <p>Monitor network connections</p>
                    </a>
                </div>
            </div>
        </div>

        <!-- Recent Activity -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Recent Activity</h3>
            </div>
            <div class="card-body p-0">
                <div class="recent-activity" id="recent-activity">
                    <div class="activity-item">
                        <div class="activity-icon visit">
                            <i class="fas fa-user-injured"></i>
                        </div>
                        <div class="activity-content">
                            <div class="activity-title">New patient visit registered</div>
                            <div class="activity-time">2 minutes ago</div>
                        </div>
                    </div>
                    
                    <div class="activity-item">
                        <div class="activity-icon test">
                            <i class="fas fa-clipboard-check"></i>
                        </div>
                        <div class="activity-content">
                            <div class="activity-title">Lab test completed</div>
                            <div class="activity-time">15 minutes ago</div>
                        </div>
                    </div>
                    
                    <div class="activity-item">
                        <div class="activity-icon equipment">
                            <i class="fas fa-microscope"></i>
                        </div>
                        <div class="activity-content">
                            <div class="activity-title">Equipment maintenance scheduled</div>
                            <div class="activity-time">1 hour ago</div>
                        </div>
                    </div>
                    
                    <div class="activity-item">
                        <div class="activity-icon inventory">
                            <i class="fas fa-box"></i>
                        </div>
                        <div class="activity-content">
                            <div class="activity-title">Inventory item restocked</div>
                            <div class="activity-time">2 hours ago</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <th:block th:fragment="page-js">
        <script>
            // Dashboard-specific JavaScript
            document.addEventListener('DOMContentLoaded', function() {
                // Load network statistics if network features are enabled
                loadNetworkStats();
                
                // Refresh stats every 30 seconds
                setInterval(() => {
                    if (window.labApp) {
                        window.labApp.loadDashboardStats();
                        loadNetworkStats();
                    }
                }, 30000);
            });
            
            async function loadNetworkStats() {
                try {
                    // Check if network features are available
                    const response = await fetch('/api/v1/network-status/features');
                    const features = await response.json();
                    
                    const networkStatsCard = document.getElementById('network-stats');
                    if (features.networkMonitoringEnabled) {
                        // Load actual network statistics
                        const networkResponse = await fetch('/api/v1/network-connections/statistics');
                        const networkStats = await networkResponse.json();
                        
                        const totalElement = networkStatsCard.querySelector('.stats-value');
                        totalElement.textContent = networkStats.total || 0;
                        
                        const statusContainer = networkStatsCard.querySelector('.status-breakdown');
                        statusContainer.innerHTML = '';
                        if (networkStats.statusBreakdown) {
                            Object.entries(networkStats.statusBreakdown).forEach(([status, count]) => {
                                const statusElement = document.createElement('div');
                                statusElement.className = 'status-item';
                                statusElement.innerHTML = `
                                    <span class="badge badge-info">${status}</span>
                                    <span>${count}</span>
                                `;
                                statusContainer.appendChild(statusElement);
                            });
                        }
                    } else {
                        // Show disabled state
                        const totalElement = networkStatsCard.querySelector('.stats-value');
                        totalElement.textContent = 'N/A';
                        
                        const statusContainer = networkStatsCard.querySelector('.status-breakdown');
                        statusContainer.innerHTML = '<small class="text-muted">Network monitoring disabled</small>';
                    }
                } catch (error) {
                    console.error('Failed to load network stats:', error);
                    const networkStatsCard = document.getElementById('network-stats');
                    const totalElement = networkStatsCard.querySelector('.stats-value');
                    totalElement.textContent = 'Error';
                }
            }
        </script>
    </th:block>
</body>
</html>
